<div class="col-md-4 mt20">
        
            
        {% if site.related_posts.size > 0 %}
        <div class="mt10 recent">
            <h3>Recommended Books For You</h3>        
             <ul>
            {% assign maxRelated = 8 %}
            {% assign minCommonTags =  2 %}
            {% assign maxRelatedCounter = 0 %}
            
            {% for post in site.posts %}

                  {% assign sameTagCount = 0 %}
                  {% assign commonTags = '' %}

                  {% for tag in post.tags %}
                        {% if post.url != page.url %}
                              {% if page.tags contains tag %}
                                    {% assign sameTagCount = sameTagCount | plus: 1 %}
                                    {% capture tagmarkup %} 
                                          <span class="label label-default">{{ tag }}</span> 
                                    {% endcapture %}
                                    {% assign commonTags = commonTags | append: tagmarkup %}
                              {% endif %}
                        {% endif %}
                  {% endfor %}

                  {% if sameTagCount >= minCommonTags %}
                  <li>
                        <p>
                        <a title="{{ post.title }}" href="{{ post.url | prepend: site.baseurl }}">{{ post.title | truncate: 45 }}</a>
                        
                        </p>
                  </li>

                        {% assign maxRelatedCounter = maxRelatedCounter | plus: 1 %}
                        {% if maxRelatedCounter >= maxRelated %}
                              {% break %}
                        {% endif %}
                  {% endif %}

            {% endfor %}

                
              </ul>
        </div>
        {% endif %}

        
       

</div>
